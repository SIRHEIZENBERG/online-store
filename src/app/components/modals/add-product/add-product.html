<div class="dialog-container">
  <div class="dialog-header">
    <h2 mat-dialog-title>{{ editMode ? 'Edit Product' : 'Add New Product' }}</h2>
    <button class="dialog-close" (click)="onCancel()" type="button">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
  </div>

  <div mat-dialog-content class="dialog-content">
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">Product Title *</label>
        <input
          type="text"
          id="title"
          formControlName="title"
          placeholder="e.g., Wireless Headphones"
        />
        <div class="error-message" *ngIf="title?.invalid && title?.touched">
          Product title is required
        </div>
      </div>

      <div class="form-group">
        <label for="price">Price (KES) *</label>
        <div class="price-input-wrapper">
          <span class="currency-prefix">KES</span>
          <input
            type="number"
            id="price"
            formControlName="price"
            autocapitalize="off"
            placeholder="2500"
          />
        </div>
        <div class="error-message" *ngIf="price?.invalid && price?.touched">
          <span *ngIf="price?.errors?.['required']">Price is required</span>
          <span *ngIf="price?.errors?.['min']">Price must be greater than 0</span>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea
          id="description"
          formControlName="description"
          rows="4"
          placeholder="Product description..."
        ></textarea>
      </div>

      <div class="form-group">
        <label for="image">Product Images *</label>
        <div class="file-input-wrapper">
          <input
            type="file"
            id="image"
            (change)="onImageUpload($event)"
            accept="image/*"
            multiple
            [disabled]="uploading || saving"
            #fileInput
          />
          <button
            type="button"
            class="file-input-button"
            (click)="fileInput.click()"
            [disabled]="uploading || saving"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            {{ uploading ? 'Uploading...' : 'Choose Images' }}
          </button>
        </div>

        <small>Max 5MB per image. JPG, PNG, or GIF. Select multiple files at once.</small>

        <div class="upload-status" *ngIf="uploading">
          <svg
            class="spinner"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 12a9 9 0 1 1-6.219-8.56" />
          </svg>
          <p>Uploading images...</p>
        </div>

        <div class="upload-error" *ngIf="uploadError">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          <p>{{ uploadError }}</p>
        </div>

        <div class="images-preview-grid" *ngIf="uploadedImages && uploadedImages.length > 0">
          <div class="image-preview" *ngFor="let url of uploadedImages; let i = index">
            <img [src]="url" alt="Product image {{ i + 1 }}" />
            <button
              type="button"
              class="remove-image-btn"
              (click)="removeImage(i)"
              title="Remove image"
              [disabled]="saving"
            >
              Ã—
            </button>
            <span class="image-number">{{ i + 1 }}</span>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div mat-dialog-actions class="dialog-actions">
    <button type="button" class="btn-cancel" (click)="onCancel()" [disabled]="saving">
      Cancel
    </button>
    <button
      type="button"
      class="btn-submit"
      (click)="onSubmit()"
      [disabled]="productForm.invalid || !uploadedImages.length || uploading || saving"
    >
      <svg
        *ngIf="saving"
        class="spinner"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M21 12a9 9 0 1 1-6.219-8.56" />
      </svg>
      <span>{{ saving ? 'Saving...' : editMode ? 'Update Product' : 'Add Product' }}</span>
    </button>
  </div>
</div>
